{"version":3,"sources":["../../lib/executor.js","../../lib/util.js","../../lib/sparkle.js"],"names":["execute","expression","dataContext","magicContext","rightSideSafeExpression","test","Object","entries","key","value","__alreadyBound","boundFunction","bind","__noReactive","func","Function","result","doIfNotNull","callback","getChildren","element","Array","from","children","addUniqueTrackedListener","type","handler","__trackedEvents","addEventListener","runOnInit","hasInited","addDataToProxy","proxy","data","getNearestRootElement","parentElement","__rootElement","getInjectedDataContext","recursive","parentsData","getInjectedData","addToProxy","__isProxy","injectData","__sData","Proxy","set","target","property","runAttributes","get","getAttribute","refKey","nearestRootElement","shouldDisplay","style","display","shouldShow","visibility","opacity","__hidden","attributeAndDataKeys","split","forEach","attributeAndDataKey","attribute","dataKey","className","setAttribute","valueKey","list","childTemplate","__childTemplate","innerHTML","clone","cloneNode","appendChild","text","innerText","html","eventsAndExpressions","eventAndExpression","eventName","event","magic","$event","push","child","init","document","body","window","onload"],"mappings":"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","file":"sparkle.a82684c1.js","sourceRoot":"..\\src","sourcesContent":["export function execute(expression, dataContext = {}, magicContext = {}) {\r\n    // Some fancy Regex magic taken from alpine.js' source\r\n    // Basically, if the expression starts with 'if' or 'let'/'const' wrap them in an anonymous function\r\n    const rightSideSafeExpression = 0\r\n        // Support expressions starting with \"if\" statements like: \"if (...) doSomething()\"\r\n        || /^[\\n\\s]*if.*\\(.*\\)/.test(expression)\r\n        // Support expressions starting with \"let/const\" like: \"let foo = 'bar'\"\r\n        || /^(let|const)/.test(expression)\r\n        ? `(() => { ${expression} })()`\r\n        : expression\r\n\r\n    // For any functions in the dataContext, bind the dataContext to them as 'this'\r\n    for (const [key, value] of Object.entries(dataContext)) {\r\n        if (typeof value === 'function') {\r\n            if (value.__alreadyBound) continue\r\n            const boundFunction = value.bind(dataContext)\r\n            boundFunction.__alreadyBound = true\r\n            dataContext[key] = { __noReactive: true, value: boundFunction }\r\n        }\r\n    }\r\n\r\n    // Run the expression with the dataContext\r\n    const func = new Function(['__self', 'scope', 'magic'], \r\n        `\r\n        with (magic) { \r\n            with (scope) {\r\n                __self.result = ${rightSideSafeExpression};\r\n            }\r\n        }\r\n        return __self.result;`\r\n    )\r\n    func(func, dataContext, magicContext)\r\n    return func.result\r\n}","export function doIfNotNull(value, callback) {\r\n    if (value) callback(value)\r\n}\r\n\r\nexport function getChildren(element) {\r\n    return Array.from(element.children)\r\n}\r\n\r\nexport function addUniqueTrackedListener(element, type, handler) {\r\n    if (!element.__trackedEvents) element.__trackedEvents = {}\r\n    if (!element.__trackedEvents[type]) element.addEventListener(type, handler)\r\n    element.__trackedEvents[type] = true\r\n}","import { execute } from './executor.js'\r\nimport { addUniqueTrackedListener, doIfNotNull, getChildren } from './util.js'\r\n\r\n// Add a little sparkle âœ¨ to my HTML\r\n// Modeled off alpine.js\r\n\r\n// Has data, for, text, html, bind, if, on, ref, and init attributes\r\n// Add new attributes:\r\n// s-effect (this one might be pretty hard)\r\n// Also want to add a store and a couple other useful injected global properties\r\n\r\nconst runOnInit = []\r\nlet hasInited = false\r\n\r\nfunction addDataToProxy(proxy, data) {\r\n    for (const [key, value] of Object.entries(data)) {\r\n        if (proxy[key] && proxy[key].__noReactive) {\r\n            proxy[key].value = value\r\n        } else {\r\n            proxy[key] = { __noReactive: true, value }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getNearestRootElement(element) {\r\n    while (element.parentElement) {\r\n        if (element.parentElement.__rootElement) {\r\n            return element.parentElement\r\n        }\r\n        element = element.parentElement\r\n    }\r\n    return null\r\n}\r\n\r\nfunction getInjectedDataContext(element) {\r\n    // Go up the parent chain and append each element's data to the context\r\n    function recursive(element, data) {\r\n        if (!element.parentElement) return {}\r\n        const parentsData = recursive(element.parentElement, getInjectedData(element))\r\n\r\n        // Everything below is UGLY and needs to be looked at again someday\r\n        // Make sure we are adding information into the proxy not into a regular object\r\n        let proxy = {}\r\n        let addToProxy = {}\r\n        if (data.__isProxy || (data.__isProxy && parentsData.__isProxy)) {\r\n            proxy = data\r\n            addToProxy = parentsData\r\n        }\r\n        if (parentsData.__isProxy) {\r\n            proxy = parentsData\r\n            addToProxy = data\r\n        }\r\n\r\n        addDataToProxy(proxy, addToProxy)\r\n\r\n        return proxy\r\n    }\r\n    return recursive(element, {})\r\n}\r\n\r\nfunction injectData(element, data) {\r\n    // If there isn't already data, make a proxy\r\n    if (!element.__sData) {\r\n        element.__sData = data\r\n        element.__sData = new Proxy(element.__sData, {\r\n            set: (target, property, value) => {\r\n                if (value.__noReactive) {\r\n                    target[property] = value.value\r\n                } else {\r\n                    target[property] = value\r\n                    runAttributes(element)\r\n                }\r\n                return true\r\n            },\r\n            get: (target, property) => {\r\n                if (property == \"__isProxy\") return true\r\n                return target[property]\r\n            }\r\n        })\r\n    } else {\r\n        // Otherwise add new data to exisiting proxy\r\n        addDataToProxy(element.__sData, data)\r\n    }\r\n}\r\n\r\nfunction getInjectedData(element) {\r\n    // Retrieve injected data from an element\r\n    return element.__sData ? element.__sData : {}\r\n}\r\n\r\nfunction runAttributes(element) {\r\n    // s-data\r\n    // Inject data into the element\r\n    if (!hasInited) doIfNotNull(element.getAttribute('s-data'), (expression) => {\r\n        const data = execute(expression)\r\n        injectData(element, data)\r\n        element.__rootElement = true\r\n    })\r\n    // s-ref\r\n    // Display or don't\r\n    doIfNotNull(element.getAttribute('s-ref'), (refKey) => {\r\n        const nearestRootElement = getNearestRootElement(element)\r\n        if (nearestRootElement) injectData(nearestRootElement, { [refKey]: element })\r\n    })\r\n    // s-if\r\n    // Display or don't\r\n    doIfNotNull(element.getAttribute('s-if'), (expression) => {\r\n        const shouldDisplay = execute(expression, getInjectedDataContext(element))\r\n        element.style.display = shouldDisplay ? null : 'none'\r\n    })\r\n    // s-show\r\n    // Visibility\r\n    doIfNotNull(element.getAttribute('s-show'), (expression) => {\r\n        const shouldShow = execute(expression, getInjectedDataContext(element))\r\n        element.style.visibility = shouldShow ? null : 'hidden'\r\n        element.style.opacity = shouldShow ? null : '0'\r\n        element.__hidden = !shouldShow\r\n    })\r\n    // s-bind\r\n    // Bind an attribute on the element to a piece of data\r\n    doIfNotNull(element.getAttribute('s-bind'), (attributeAndDataKeys) => {\r\n        if (element.__hidden) return\r\n        attributeAndDataKeys.split(' and ').forEach(attributeAndDataKey => {\r\n            const [attribute, dataKey] = attributeAndDataKey.split(' to ')\r\n            const value = execute(dataKey, getInjectedDataContext(element))\r\n\r\n            if (attribute === 'class') {\r\n                element.className = value\r\n                return\r\n            }\r\n\r\n            element.setAttribute(attribute, value)\r\n            element[attribute] = value\r\n        })\r\n    })\r\n    // s-for\r\n    // Repeat a child element\r\n    doIfNotNull(element.getAttribute('s-for'), (expression) => {\r\n        if (element.__hidden) return\r\n        // Get list of items\r\n        const [valueKey, dataKey] = expression.split(' in ')\r\n        const list = execute(dataKey, getInjectedDataContext(element))\r\n\r\n        // Get child element\r\n        const children = getChildren(element)\r\n        const childTemplate = children[0]\r\n\r\n        element.__childTemplate = childTemplate ? childTemplate : element.__childTemplate\r\n\r\n        // Clear template child element\r\n        element.innerHTML = \"\"\r\n\r\n        // Clone child element for each item in list\r\n        list.forEach(value => {\r\n            const clone = element.__childTemplate.cloneNode(true)\r\n            injectData(clone, { [valueKey]: value })\r\n            element.appendChild(clone)\r\n        })\r\n    })\r\n    // s-text\r\n    // Inject a piece of data into element's innerText\r\n    doIfNotNull(element.getAttribute('s-text'), (expression) => {\r\n        if (element.__hidden) return\r\n        const text = execute(expression, getInjectedDataContext(element))\r\n        element.innerText = text\r\n    })\r\n    // s-html\r\n    // Inject a piece of data into element's innerHTML\r\n    doIfNotNull(element.getAttribute('s-html'), (expression) => {\r\n        if (element.__hidden) return\r\n        const html = execute(expression, getInjectedDataContext(element))\r\n        element.innerHTML = html\r\n    })\r\n    // s-on\r\n    // Attach an event listener to the element\r\n    doIfNotNull(element.getAttribute('s-on'), (eventsAndExpressions) => {\r\n        if (element.__hidden) return\r\n        eventsAndExpressions.split(' and ').forEach(eventAndExpression => {\r\n            const [eventName, expression] = eventAndExpression.split(' do ')\r\n\r\n            if (!expression) return\r\n\r\n            addUniqueTrackedListener(element, eventName, (event) => {\r\n                const magic = { $event: event }\r\n                execute(expression, getInjectedDataContext(element), magic)\r\n            })\r\n        })\r\n    })\r\n    // s-init\r\n    // Run expressions on sparkle init\r\n    if (!hasInited) doIfNotNull(element.getAttribute('s-init'), (expression) => {\r\n        runOnInit.push(() => execute(expression, getInjectedDataContext(element)))\r\n    })\r\n\r\n    // Process children\r\n    getChildren(element).forEach(child => {\r\n        runAttributes(child)\r\n    })\r\n}\r\n\r\nexport function init() {\r\n    getChildren(document.body).forEach(element => {\r\n        runAttributes(element)\r\n    })\r\n    hasInited = true\r\n    runOnInit.forEach(func => func())\r\n}\r\n\r\nwindow.onload = init"]}